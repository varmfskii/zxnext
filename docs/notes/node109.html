<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2019 (Released January 1, 2019) -->
<HTML lang="EN">
<HEAD>
<TITLE>ZX Spectrum Next Registers</TITLE>
<META NAME="description" CONTENT="ZX Spectrum Next Registers">
<META NAME="keywords" CONTENT="000-document">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2019">

<LINK REL="STYLESHEET" HREF="000-document.css">

<LINK REL="next" HREF="node110.html">
<LINK REL="previous" HREF="node108.html">
<LINK REL="next" HREF="node110.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node110.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node108.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node108.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html824"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html826"
  HREF="node135.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node110.html">ZX Spectrum Next Registers</A>
<B> Up:</B> <A
 HREF="node108.html">Registers</A>
<B> Previous:</B> <A
 HREF="node108.html">Registers</A>
 &nbsp; <B>  <A ID="tex2html825"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html827"
  HREF="node135.html">Index</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A ID="SECTION001210000000000000000">
ZX Spectrum Next Registers</A>
</H1>
February 25, 2019  Phoebus Dokos

<P>
TBBlue stores configuration state in a field of registers. These
registers are accessible via two I/O ports or via the special nextreg
instructions.

<P>
Port $243B (9275) is used to set the register number, listed below.

<P>
Port $253B (9531) is used to access the register value.

<P>
Some registers are accessible only during the initialization process.

<P>
(R) $00 (00) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Machine ID

<UL>
<LI>00000001 = DE1A
</LI>
<LI>00000010 = DE2A
</LI>
<LI>00000101 = FBLABS
</LI>
<LI>00000110 = VTRUCCO
</LI>
<LI>00000111 = WXEDA
</LI>
<LI>00001000 = EMULATORS*
</LI>
<LI>00001010 = ZX Spectrum Next*
</LI>
<LI>00001011 = Multicore
</LI>
<LI>11111010 = ZX Spectrum Next Anti-brick*
</LI>
</UL>
* Relevant for ZX Next machines &amp; software

<P>
(R) $01 (01) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Core Version
<table width="90%">
bits 7-4 = Major version number
bits 3-0 = Minor version number<tr><td valign="top">&nbsp;See register $0E for sub minor version number
</td></tr></table>

<P>
(R/W) $02 (02) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Reset
<BR>
Read

<UL>
<LI>bit 7 = Expansion bus <!-- MATH
 $\overline{\hbox{RESET}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.22ex; vertical-align: -0.11ex; " SRC="img52.svg"
 ALT="$\overline{\hbox{RESET}}$"></SPAN> Asserted
</LI>
<LI>bits 6-2 = Reserved
</LI>
<LI>bit 1 = Last reset was Hard reset
</LI>
<LI>bit 0 = Last reset was Soft reset
</LI>
</UL>
Write

<UL>
<LI>bit 7 = Generate/Release Expansion bus <!-- MATH
 $\overline{\hbox{RESET}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.22ex; vertical-align: -0.11ex; " SRC="img52.svg"
 ALT="$\overline{\hbox{RESET}}$"></SPAN>
</LI>
<LI>bits 6-2 = Reserved, must be 0
</LI>
<LI>bit 1 = generate Hard reset
</LI>
<LI>bit 0 = generate Soft reset
</LI>
</UL>

<P>
(R/W) $03 (03) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Machine Type
<BR>
A write to this register disables the boot rom in config mode
<BR>
bits 2-0 select machine type when in config mode
<table width="90%">
bit 7 = (W) Display Timing change enable (allow changes to
  bits 6-4) (0 on hard reset)
bits 6-4 = Display Timing
bit 3 = Display Timing user lock control
  <tr><td valign="top">&nbsp;Read
  
<UL>
<LI>0 = No user lock on display timing
</LI>
<LI>1 = User lock on display timing
  
</LI>
</UL>
  </td></tr>
<tr><td valign="top">&nbsp;Write
  
<UL>
<LI>1 = Apply user lock on display timing (0 on hard reset)
  
</LI>
</UL>
bits 2-1 = Machine Type</td></tr>
<tr><td valign="top">&nbsp;Machine Types/Display Timings
  
<UL>
<LI>000 or 001 = ZX 48K
</LI>
<LI>010 = ZX 128K/+2 (Grey)
</LI>
<LI>011 = ZX +2A-B/+3e/Next Native
</LI>
<LI>100 = Pentagon 128K
  
</LI>
</UL></td></tr></table>

<P>
(W) $04 (04) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Configuration Mapping
<table width="90%">
bits 7-5 = Reserved, must be 0
bits 4-0 = 16k SRAM bank mapping* ($00 on hard reset)<tr><td valign="top">&nbsp;*Maps a 16k SRAM bank over the bottom 16k. Applies only in
  config mode when the bootrom is disabled
</td></tr></table>

<P>
(R/W) $05 (05) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Peripheral 1 Settings

<UL>
<LI>bits 7-6 = joystick 1 mode (MSB)
</LI>
<LI>bits 5-4 = joystick 2 mode (MSB)
</LI>
<LI>bit 3 = joystick 1 mode (LSB)
</LI>
<LI>bit 2 = 50/60 Hz mode (0 = 50Hz, 1 = 60Hz)
</LI>
<LI>bit 1 = joystick 2 mode (LSB)
</LI>
<LI>bit 0 = Enable Scandoubler
</LI>
</UL>
Joystick modes

<UL>
<LI>000 = Sinclair 2 (67890)
</LI>
<LI>001 = Kempston 2 (port $37)
</LI>
<LI>010 = Kempston 1 (port $1F)
</LI>
<LI>011 = Megadrive 1 (port $1F)
</LI>
<LI>100 = Cursor
</LI>
<LI>101 = Megadrive 2 (port $37)
</LI>
<LI>110 = Simclair 1 (12345)
</LI>
</UL>

<P>
(R/W) $06 (06) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Peripheral 2 Settings

<UL>
<LI>bit 7 = F8 CPU Speed Hotkey Enable (1 on reset)
</LI>
<LI>bit 6 = DMA mode (0 = zxnDMA, 1 = Z80DMA) (0 on hard reset)
</LI>
<LI>bit 5 = F3 50Hz/60Hz Hotkey Enable (1 on reset)
</LI>
<LI>bit 4 = divMMC Automap/NMI Enable (0 on hard reset)
</LI>
<LI>bit 3 = NMI Button Enable (0 on hard reset)
</LI>
<LI>bit 2 = PS/2 Mode (0 = keyboard, 1 = mouse)
</LI>
<LI>bits 1-0 = PSG Mode (00 = YM, 01 = AY, 11 = hold all PSGs in Reset)
</LI>
</UL>

<P>
(R/W) $07 (07) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Turbo mode
<BR>
Read

<UL>
<LI>bits 7-6 = Reserved
</LI>
<LI>bits 5-4 = Current Actual CPU Speed
</LI>
<LI>bits 3-2 = Reserved
</LI>
<LI>bits 1-0 = Current Selected CPU Speed (00 on reset)
</LI>
</UL>
Write

<UL>
<LI>bits 7-2 = Reserved, must be 0
</LI>
<LI>bits 1-0 = Select CPU Speed
</LI>
</UL>
CPU Speeds

<UL>
<LI>00 = 3.5MHz
</LI>
<LI>01 = 7MHz
</LI>
<LI>10 = 14MHz
</LI>
<LI>11 = 28MHz
</LI>
</UL>

<P>
(R/W) $08 (08) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Peripheral 3 Settings

<UL>
<LI>bit 7 = 128K Banking Unlock (inverse of port $7FFD, bit 5) (0
  on reset)
</LI>
<LI>bit 6 = Disable RAM and Port Contention (0 on reset)
</LI>
<LI>bit 5 = PSG Stereo Mode Control (0 = ABC, 1 = ACB) (0 on hard
  reset)
</LI>
<LI>bit 4 = Enable internal speaker (1 on hard reset)
</LI>
<LI>bit 3 = Enable DACs (0 on hard reset)
</LI>
<LI>bit 2 = Enable read of port $FF (Timex) (0 on hard reset)
</LI>
<LI>bit 1 = Enable Multiple PSGs (0 on hard reset)
</LI>
<LI>bit 0 = Enable Issue 2 Keyboard
</LI>
</UL>

<P>
(R/W) $09 (09) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Peripheral 4 setting:
<table width="90%">
bit 7 = PSG 2 Mono Enable (0 on hard reset)
bit 6 = PSG 1 Mono Enable (0 on hard reset)
bit 5 = PSG 0 Mono Enable (0 on hard reset)
bit 4 = Sprite ID lockstep enable (1 = Nextreg $34 and IO Port
  $303B are in lockstep, 0 on reset)
bit 3 = divMMC mapRAM bit Control (reset bit 7 of port $E3)
bit 2 = HDMI audio mute (0 on hard reset)
bits 1-0 = scanlines
  
<UL>
<LI>00 = scanlines off
</LI>
<LI>01 = scanlines 75%
</LI>
<LI>10 = scanlines 50%
</LI>
<LI>11 = scanlines 25%
  
</LI>
</UL><tr><td valign="top">&nbsp;In Sprite lockstep, NextREG $34 and Port $303B are in
  lockstep
</td></tr></table>

<P>
(R) $0E (0E) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Core Version (sub minor number)
<table width="90%">
bits 7-0 = Core sub minor version number<tr><td valign="top">&nbsp;(see register $01 for the major and minor version number)
</td></tr></table>

<P>
(R/W) $10 (10) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Core Boot
<BR>
Read

<UL>
<LI>bits 7-2 = Reserved
</LI>
<LI>bit 1 = Drive button pressed
</LI>
<LI>bit 0 = NMI button pressed
</LI>
</UL>
Write
<table width="90%">
bit 7 = Reboot FPGA using selected core (0 on reset)
bits 6-5 = Reserved, must be 0
bits 4-0 = Core ID<tr><td valign="top">&nbsp;Core ID with bits 4-0 can only be set in configuration mode
</td></tr></table>

<P>
(R/W) $11 (11) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Video Timing (writable in config mode only)
<table width="90%">
bits 7-3 = Reserved, must be 0
bits 2-0 = Mode (VGA = 0..6, HDMI = 7)
  
<UL>
<LI>000 = Base VGA timing, clk28 = 28000000
</LI>
<LI>001 = VGA setting 1, clk28 = 28571429
</LI>
<LI>010 = VGA setting 2, clk28 = 29464286
</LI>
<LI>011 = VGA setting 3, clk28 = 30000000
</LI>
<LI>100 = VGA setting 4, clk28 = 31000000
</LI>
<LI>101 = VGA setting 5, clk28 = 32000000
</LI>
<LI>110 = VGA setting 6, clk28 = 33000000
</LI>
<LI>111 = HDMI, clk28 = 27000000
  
</LI>
</UL><tr><td valign="top">&nbsp;50/60Hz selection depends on bit 2 of register $05</td></tr>
<tr><td valign="top">&nbsp;Only writable in config mode
</td></tr></table>

<P>
(R/W) $12 (12) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 2 Active RAM bank

<UL>
<LI>bits 7-6 = Reserved, must be 0
</LI>
<LI>bits 5-0 = RAM bank (point to bank 8 after a Reset, NextZXOS
  modifies to 9)
</LI>
</UL>

<P>
(R/W) $13 (13) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 2 Shadow RAM bank

<UL>
<LI>bits 7-6 = Reserved, must be 0
</LI>
<LI>bits 5-0 = RAM bank (point to bank 11 after a Reset, NextZXOS
  modifies to 12)
</LI>
</UL>

<P>
(R/W) $14 (14) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Global transparency color

<UL>
<LI>bits 7-0 = Transparency color value ($E3 after a reset)
</LI>
</UL>
(Note: this value is 8-bit, so the transparency is compared against
only by the MSB bits of the final 9-bit colour)
<BR>(Note2: this only affects Layer 2, ULA and LoRes. Sprites use register
$4B for transparency and tilemap uses nextreg $4C)

<P>
(R/W) $15 (15) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite and Layer System Setup

<UL>
<LI>bit 7 = LoRes mode (0 on reset)
</LI>
<LI>bit 6 = Sprite priority (1 = sprite 0 on top, 0 = sprite 127 on
  top) (0 on reset)
</LI>
<LI>bit 5 = Enable sprite clipping in over border mode (0 on reset)
</LI>
<LI>bits 4-2 = set layers priorities (000 on reset)
  
<UL>
<LI>000 - S L U
</LI>
<LI>001 - L S U
</LI>
<LI>010 - S U L
</LI>
<LI>011 - L U S
</LI>
<LI>100 - U S L
</LI>
<LI>101 - U L S
</LI>
<LI>110 - S(U+L) ULA and Layer 2 combined, colours clamped to 7
</LI>
<LI>111 - S(U+L-5) ULA and Layer 2 combined, colours clamped to [0,7]
  
</LI>
</UL>
</LI>
<LI>bit 1 = Enable Sprites Over border (0 on reset)
</LI>
<LI>bit 0 = Enable Sprites (0 on reset)
</LI>
</UL>

<P>
(R/W) $16 (16) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 2 Horizontal Scroll Control

<UL>
<LI>bits 7-0 = X Offset (0-255)(0 on reset)
</LI>
</UL>

<P>
(R/W) $17 (17) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 2 Vertical Scroll Control

<UL>
<LI>bits 7-0 = Y Offset (0-191)(0 on reset)
</LI>
</UL>

<P>
(R/W) $18 (18) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 2 Clip Window Definition

<UL>
<LI>bits 7-0 = Coords of the clip window
  <table width="90%">  <tr><td valign="top">&nbsp;1st write - X1 position
  </td></tr>
<tr><td valign="top">&nbsp;2nd write - X2 position
  </td></tr>
<tr><td valign="top">&nbsp;3rd write - Y1 position
  </td></tr>
<tr><td valign="top">&nbsp;4rd write - Y2 position
  </td></tr></table>
</LI>
</UL>
Reads do not advance the clip position
<BR>
The values are 0,255,0,191 after a Reset

<P>
(R/W) $19 (19) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Clip Window Definition

<UL>
<LI>bits 7-0 = Cood. of the clip window
  <table width="90%">  <tr><td valign="top">&nbsp;1st write - X1 position
  </td></tr>
<tr><td valign="top">&nbsp;2nd write - X2 position
  </td></tr>
<tr><td valign="top">&nbsp;3rd write - Y1 position
  </td></tr>
<tr><td valign="top">&nbsp;4rd write - Y2 position
  </td></tr></table>
</LI>
</UL>
The values are 0,255,0,191 after a Reset
<BR>
Reads do not advance the clip position

<P>
When the clip window is enabled for sprites in "over border" mode, the
X coords are internally doubled and the clip window origin is moved to
the sprite origin inside the border.

<P>
(R/W) $1A (1A) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 0 (ULA/LoRes) Clip Window Definition

<UL>
<LI>bits 7-0 = Coord. of the clip window
  <table width="90%">  <tr><td valign="top">&nbsp;1st write = X1 position
  </td></tr>
<tr><td valign="top">&nbsp;2nd write = X2 position
  </td></tr>
<tr><td valign="top">&nbsp;3rd write = Y1 position
  </td></tr>
<tr><td valign="top">&nbsp;4rd write = Y2 position
  </td></tr></table>
</LI>
</UL>
The values are 0,255,0,191 after a Reset
<BR>
Reads do not advance the clip position

<P>
(R/W) $1B (1B) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 3 (Tilemap) Clip Window Definition

<UL>
<LI>bits 7-0 = Coord. of the clip window
  <table width="90%">  <tr><td valign="top">&nbsp;1st write = X1 position
  </td></tr>
<tr><td valign="top">&nbsp;2nd write = X2 position
  </td></tr>
<tr><td valign="top">&nbsp;3rd write = Y1 position
  </td></tr>
<tr><td valign="top">&nbsp;4rd write = Y2 position
  </td></tr></table>
</LI>
</UL>
The values are 0,159,0,255 after a Reset
<BR>
Reads do not advance the clip position
<BR>
The X coords are internally doubled.

<P>
(R/W) $1C (1C) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Clip Window Control
<BR>
Read

<UL>
<LI>bits 7-6 = Layer 3 Clip Index
</LI>
<LI>bits 5-4 = Layer 0/1 Clip Index
</LI>
<LI>bits 3-2 = Sprite clip index
</LI>
<LI>bits 1-0 = Layer 2 Clip Index
</LI>
</UL>
Write

<UL>
<LI>bits 7-4 = Reserved, must be 0
</LI>
<LI>bit 3 - reset Layer 3 clip index
</LI>
<LI>bit 2 - reset Layer 0/1 clip index
</LI>
<LI>bit 1 - reset sprite clip index.
</LI>
<LI>bit 0 - reset Layer 2 clip index.
</LI>
</UL>

<P>
(R) $1E (1E) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Active video line (MSB)

<UL>
<LI>bits 7-1 = Reserved
</LI>
<LI>bit 0 = Active line MSB
</LI>
</UL>

<P>
(R) $1F (1F) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Active video line (LSB)

<UL>
<LI>bits 7-0 = Active line LSB (0-255)
</LI>
</UL>

<P>
(R/W) $22 (22) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Line Interrupt control

<UL>
<LI>bit 7 = (R) ULA asserting interrupt
</LI>
<LI>bit 7 = (W) Reserved, must be 0
</LI>
<LI>bits 6-3 = Reserved, must be 0
</LI>
<LI>bit 2 = Disable ULA Interrupt (0 on reset)
</LI>
<LI>bit 1 = Enable Line Interrupt (0 on reset)
</LI>
<LI>bit 0 = MSB of Line Interrupt line value (0 on reset)
</LI>
</UL>

<P>
(R/W) $23 (23) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Line Interrupt value LSB

<UL>
<LI>bits 7-0 = Line Interrupt line value LSB (0-255)(0 on reset)
</LI>
</UL>

<P>
(R/W) $26 (26) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> ULA Horizontal Scroll Control

<UL>
<LI>bits 7-0 = ULA X Offset (0-255) (0 on reset)
</LI>
</UL>

<P>
(R/W) $27 (27) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> ULA Vertical Scroll Control

<UL>
<LI>bits 7-0 = ULA Y Offset (0-191) (0 on reset)
</LI>
</UL>

<P>
(R/W) $28 (28) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Stored Palette Value and PS/2 Keymap Address MSB
<BR>
Read

<UL>
<LI>bits 7-0 = Stored palette value (see NextREG $44)
</LI>
</UL>
Write  

<UL>
<LI>bits 7-1 = Reserved, must be 0
</LI>
<LI>bit 0 = PS/2 Keymap Address MSB
</LI>
</UL>

<P>
(W) $29 (29) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> PS/2 Keymap Address LSB

<UL>
<LI>bits 7-0 = PS/2 Keymap Address LSB
</LI>
</UL>

<P>
(W) $2A (2A) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> PS/2 Keymap Data MSB

<UL>
<LI>bits 7-1 = Reserved, must be 0
</LI>
<LI>bit 0 = PS/2 Keymap Data MSB
</LI>
</UL>

<P>
(W) $2B (2B) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> PS/2 Keymap Data LSB

<UL>
<LI>bits 7-0 = PS/2 Keymap Data LSB
</LI>
</UL>
(writing this register auto-increments the address)

<P>
(R/W) $2C (2C) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> DAC B Mirror (Left)/ I<SUP>2</SUP>S Left Sample MSB
<BR>
Read

<UL>
<LI>bits 7-0 =  I<SUP>2</SUP>S Left Sample MSB
</LI>
</UL>
Write

<UL>
<LI>bits 7-0 = 8-bit sample left DAC ($80 on reset)
</LI>
</UL>

<P>
(R/W) $2D (2D) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> DAC A+D Mirror (mono/ I<SUP>2</SUP>S Sample LSB
<BR>
Read

<UL>
<LI>bits 7-0 =  I<SUP>2</SUP>S Last Sample LSB
</LI>
</UL>
Write

<UL>
<LI>bits 7-0 = 8-bit sample DACs A + D ($80 on reset)
</LI>
</UL>

<P>
(R/W) $2E (2E) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> DAC C Mirror (Right/ I<SUP>2</SUP>S Risht Sample MSB
<BR>
Read

<UL>
<LI>bits 7-0 =  I<SUP>2</SUP>S Right Sameple MSB
</LI>
</UL>
Write

<UL>
<LI>bits 7-0 = 8-bit sample Right DACs C ($80 on reset)
</LI>
</UL>

<P>
(R/W) $2F (2F) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 3 (Tilemap) Horizontal Scroll Control MSB

<UL>
<LI>bits 7-2 = Reserved, must be 0
</LI>
<LI>bits 1-0 = X Offset MSB ($00 on reset)
</LI>
</UL>
Meaningful Range is 0-319 in 40 char mode, 0-639 in 80 char mode

<P>
(R/W) $30 (30) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 3 (Tilemap) Horizontal Scroll Control LSB

<UL>
<LI>bits 7-0 = X Offset LSB ($00 on reset)
</LI>
</UL>
Meaningful range is 0-319 in 40 char mode, 0-639 in 80 char mode

<P>
(R/W) $31 (31) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 3 (Tilemap) Vertical Scroll Control

<UL>
<LI>bits 7-0 = Y Offset (0-255) )$00 on reset)
</LI>
</UL>

<P>
(R/W) $32 (32) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 1,0 (LoRes) Horizontal Scroll Control)

<UL>
<LI>bits 7-0 = X Offset (0-255) ($00 on reset)
</LI>
</UL>
Layer 1,0 (LoRes) scrolls in "half-pixels" at the same resolution and
smoothness as Layer 2.

<P>
(R/W) $33 (33) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Layer 1,0 (LoRes) Vertical Scroll Control)

<UL>
<LI>bits 7-0 = Y Offset (0-191) ($00 on reset)
</LI>
</UL>
Layer 1,0 (LoRes) scrolls in "half-pixels" at the same resolution and
smoothness as Layer 2.

<P>
(R/W) $34 (34) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Number
<BR>
Lockstep (NextReg $09 bit 4 set)
<table width="90%">
bit 7 = Pattern address offset (Add 128 to pattern address)
bits 6-0 = Sprite number 0-127, Pattern number 0-63<tr><td valign="top">&nbsp;effectively performs an out to port $303B
</td></tr></table>

No Lockstep (NextReg $09 bit 4 clear)

<UL>
<LI>bit 7 = Reserved, must be 0
</LI>
<LI>bits 6-0 = Sprite number 0-127
</LI>
</UL>
This register selects which sprite has its attributes connected to the
sprite attribute registers

<P>
(W) $35 (35) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Attribute 0

<UL>
<LI>bits 7-0 = Sprite X coordinate LSB (MSB in NextReg $37)
</LI>
</UL>

<P>
(W) $36 (36) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Attribute 1

<UL>
<LI>bits 7-0 = Sprite Y coordinate LSB (MSB in NextReg $39)
</LI>
</UL>

<P>
(W) $37 (37) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Attribute 2

<UL>
<LI>bits 7-4 = 4-bit Palette offset
</LI>
<LI>bit 3 = Enable horizontal mirror (reverse)
</LI>
<LI>bit 2 = Enable vertical mirror (reverse)
</LI>
<LI>bit 1 = Enable 90<SPAN CLASS="MATH"><IMG STYLE="height: 2.21ex; vertical-align: -0.11ex; " SRC="img53.svg"
 ALT="$^O$"></SPAN> Clockwise Rotation
</LI>
</UL>
Normal Sprites

<UL>
<LI>bit 0 = X coordinate MSB
</LI>
</UL>
Relative Sprites

<UL>
<LI>bit 0 = Palette offset is relative to anchor sprite
</LI>
</UL>
Rotation is applied before mirroring

<P>
(W) $38 (38) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Attribute 3

<UL>
<LI>bit 7 = Enable Visiblity
</LI>
<LI>bit 6 = Enable Attribute 4 (0 = Attribute 4 effectively $00)
</LI>
<LI>bits 5-0 = Sprite Pattern Number
</LI>
</UL>

<P>
(W) $39 (39) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Attribute 4
<BR>
Normal Sprites

<UL>
<LI>bit 7 = 4-bit pattern switch (0 = 8-bit sprite, 1 = 4-bit sprite)
</LI>
<LI>bit 6 = Pattern number bit-7 for 4-bit, 0 for 8-bit
</LI>
<LI>bit 5 = Type of attached relative sprites (0 = Composite, 1 =
  Unified)
</LI>
<LI>bits 4-3 = X scaling (00 = 1x, 01 = 2x, 10 = 4x, 11 = 8x)
</LI>
<LI>bits 2-1 = Y scaling (00 = 1x, 01 = 2x, 10 = 4x, 11 = 8x)
</LI>
<LI>bit 0 = MSB of Y coordinate
</LI>
</UL>
Relative, Composite Sprites

<UL>
<LI>bit 7-6 = 01
</LI>
<LI>bit 5 = Pattern number bit-7 for 4-bit, 0 for 8-bit
</LI>
<LI>bits 4-3 = X scaling (00 = 1x, 01 = 2x, 10 = 4x, 11 = 8x)
</LI>
<LI>bits 2-1 = Y scaling (00 = 1x, 01 = 2x, 10 = 4x, 11 = 8x)
</LI>
<LI>bit 0 = Pattern number is relative to anchor
</LI>
</UL>
Relative, Unified Sprites

<UL>
<LI>bit 7-6 = 01
</LI>
<LI>bit 5 = Pattern number bit-7 for 4-bit, 0 for 8-bit
</LI>
<LI>bits 4-1 = 0000
</LI>
<LI>bit 0 = Pattern number is relative to anchor
</LI>
</UL>

<P>
(R/W) $40 (40) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Index Select

<UL>
<LI>bits 7-0 = Palette Index Number
</LI>
</UL>
Selects the palette index to change the associated colour

<P>
For ULA only, INKs are mapped to indices 0 through 7, BRIGHT INKs to
indices 8 through 15, PAPERs to indices 16 through 23 and BRIGHT
PAPERs to indices 24 through 31.  In EnhancedULA mode, INKs come from
a subset of indices from 0 through 127 and PAPERs from a subset of
indices from 128 through 255.

<P>
The number of active indices depends on the number of attribute bits
assigned to INK and PAPER out of the attribute byte.

<P>
In ULAplus mode, the last 64 entries (indices 192 to 255) hold the
ULAplus palette.  The ULA always takes border colour from PAPER for
standard ULA and Enhanced ULA

<P>
(R/W) $41 (41) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> 8-bit Palette Data

<UL>
<LI>bits 7-0 = Colour Entry in RRRGGGBB format
</LI>
</UL>
The lower blue bit of the 9-bit internal colour will be the logical or
of bits 0 and 1 of the 8-bit entry. After each write, the palette
index auto-increments if aut-increment has been enabled (NextReg $43
bit 7), Reads do not auto-increment.

<P>
(R/W) $42 (42) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> ULANext Attribute Byte Format

<UL>
<LI>bits 7-0 = Attribute byte's INK representation mask (7 on reset)
</LI>
</UL>
The mask can only indicate a solid sequence of bits on the right side
of the attribute byte (1, 3, 7, 15, 31, 63, 127 or 255).

<P>
INKs are mapped to base index 0 in the palette and PAPERs and border
are mapped to base index 128 in the palette.

<P>
The 255 value enables the full ink colour mode making all the palette
entries INK. PAPER and border both take on the fallback colour
(nextreg $4A) in this mode.

<P>
(R/W) $43 (43) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Control

<UL>
<LI>bit 7 = Disable palette write auto-increment.
</LI>
<LI>bits 6-4 = Select palette for reading or writing:
  
<UL>
<LI>000 = ULA first palette
</LI>
<LI>100 = ULA second palette
</LI>
<LI>001 = Layer 2 first palette
</LI>
<LI>101 = Layer 2 second palette
</LI>
<LI>010 = Sprite first palette
</LI>
<LI>110 = Sprite second palette
</LI>
<LI>011 = Layer 3 first palette
</LI>
<LI>111 = Layer 3 second palette
  
</LI>
</UL>
</LI>
<LI>bit 3 = Select Sprite palette (0 = first palette, 1 = second
  palette)
</LI>
<LI>bit 2 = Select Layer 2 palette (0 = first palette, 1 = second
  palette)
</LI>
<LI>bit 1 = Select ULA palette (0 = first palette, 1 = second
  palette)
</LI>
<LI>bit 0 = Enable EnhancedULA mode if 1. (0 after a reset)
</LI>
</UL>

<P>
(R/W) $44 (44) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> 9-bit Palette Data
<BR>
Non Level 2
<table width="90%"><tr><td valign="top">&nbsp;1st write
bits 7-0 = MSB (RRRGGGBB)</td></tr>
<tr><td valign="top">&nbsp;2nd write
bits 7-1 = Reserved, must be 0
bit 0 = LSB (B)
</td></tr></table>

Level 2
<table width="90%"><tr><td valign="top">&nbsp;1st write
bits 7-0 = MSB (RRRGGGBB)</td></tr>
<tr><td valign="top">&nbsp;2nd write
bit 7 = Priority
bits 6-1 = Reserved, must be 0
bit 0 = LSB (B)
</td></tr></table>

9-bit Palette Data is entered in two consecutive writes; the second
write autoincrements the palette index if auto-increment is enabled in
NextREG $43 bit 7

<P>
If writing an L2 palette, the second write's D7 holds the L2 priority
bit which if set (1) brings the colour defined at that index on top of
all other layers. If you also need the same colour in regular priority
(for example: for enviromental masking) you will have to set it up
again, this time with no priority.

<P>
Reads return the second byte and do not autoincrement.

<P>
(R/W) $4A (4A) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Fallback Colour Value

<UL>
<LI>bits 7-0 = 8-bit colour if all layers are transparent ($E3 on
  reset)
</LI>
</UL>
(black on reset = 0)

<P>
(R/W) $4B (4B) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Sprite Transparency Index

<UL>
<LI>bits 7-0 = Index value ($E3 if reset)
</LI>
</UL>
For 4-bit sprites only the bottom 4-bits are relevant.

<P>
(R/W) $4C (4C) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Level 3 Transparency Index

<UL>
<LI>bits 7-4 = Reserved, must be 0
</LI>
<LI>bits 3-0 = Index value ($0F on reset)
</LI>
</UL>

<P>
(R/W) $50 (50) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 0 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $0000 to $1FFF ($ff on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.
<BR>
A 255 value causes the ROM to become visible.

<P>
(R/W) $51 (51) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 1 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $2000 to $3FFF ($ff on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.
<BR>
A 255 value causes the ROM to become visible.

<P>
(R/W) $52 (52) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 2 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $4000 to $5FFF ($0A on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
(R/W) $53 (53) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 3 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $6000 to $7FFF ($0B on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
(R/W) $54 (54) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 4 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $8000 to $9FFF ($04 on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
(R/W) $55 (55) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 5 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $A000 to $BFFF ($05 on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
(R/W) $56 (56) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 6 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $C000 to $DFFF ($00 on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
(R/W) $57 (57) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> MMU Slot 7 Control

<UL>
<LI>bits 7-0 = 8k RAM page at position $E000 to $FFFF ($01 on
  reset)
</LI>
</UL>
Pages can be from 0 to 223 on a fully expanded Next.

<P>
Writing to ports $1FFD, $7FFD and $DFFD writes $FF to MMU0 and
MMU1 and writes appropriate values to MMU6 and MMU7 to map in the
selected 16k bank.

<P>
+3 special modes override the MMUs if used.

<P>
(W) $60 (60) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Copper Data 8-bit Write

<UL>
<LI>bits 7-0 = Byte to write to copper instruction memory
</LI>
</UL>
Note that each copper instruction is two bytes long, after a write,
the coppen address is auto-incremented to the next memory position.

<P>
After a write, the index is auto-incremented to the next memory position.

<P>
(W) $61 (61) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Copper Address LSB

<UL>
<LI>bits 7-0 = Copper instruction memory address LSB (0 on reset)
</LI>
</UL>

<P>
(W) $62 (62) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Copper Control

<UL>
<LI>bits 7-6 = Start Control
  <table width="90%">  <tr><td valign="top">&nbsp;00 = Copper fully stopped
  </td></tr>
<tr><td valign="top">&nbsp;01 = Copper start, execute the list from index 0, and loop
    to the start
  </td></tr>
<tr><td valign="top">&nbsp;10 = Copper start, execute the list from last point, and
    loop to the start
  </td></tr>
<tr><td valign="top">&nbsp;11 = Copper start, execute the list from index 0, and
    restart the list when the raster reaches position (0,0)
  </td></tr></table>

</LI>
<LI>bits 2-0 = Copper instruction memory address (MSB) (0 on reset)
</LI>
</UL>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node110.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node108.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node108.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html824"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html826"
  HREF="node135.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node110.html">ZX Spectrum Next Registers</A>
<B> Up:</B> <A
 HREF="node108.html">Registers</A>
<B> Previous:</B> <A
 HREF="node108.html">Registers</A>
 &nbsp; <B>  <A ID="tex2html825"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html827"
  HREF="node135.html">Index</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
