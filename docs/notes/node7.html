<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2019 (Released January 1, 2019) -->
<HTML lang="EN">
<HEAD>
<TITLE>Next Colour Palettes</TITLE>
<META NAME="description" CONTENT="Next Colour Palettes">
<META NAME="keywords" CONTENT="zxnext_notes">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2019">

<LINK REL="STYLESHEET" HREF="zxnext_notes.css">

<LINK REL="previous" HREF="node6.html">
<LINK REL="next" HREF="node8.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node8.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node6.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html323"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html325"
  HREF="node156.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node8.html">Scrolling</A>
<B> Up:</B> <A
 HREF="node6.html">Palette</A>
<B> Previous:</B> <A
 HREF="node6.html">Palette</A>
 &nbsp; <B>  <A ID="tex2html324"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html326"
  HREF="node156.html">Index</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H4><A ID="SECTION00312010000000000000">
Next Colour Palettes</A>
</H4>
Each video mode group has a pair of palettes assigned to it a primary
and an alternate palette. Each palette entry is actually a 9-bit value
(RRRGGGBBB) and can be set by selecting a palette using nextreg $43
(palette control), the entry using nextreg $40 (palette index), then
writing the value into nextreg $44 (palette value, 9-bit) using pairs
of consecutive writes for each palette value or nextreg $41 (palette
value, 8-bit). Once a palette index has been selected writes
automatically increment the palette index number so it is possible to
efficiently write the values for a collection of palette entries.

<P>
(R/W) $40 (64) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Index
<table width="90%">
bits 7-0 = Select the palette index to change the associated
  colour. (soft reset = 0)<tr><td valign="top">&nbsp;For the ULA only, INKs are mapped to indices 0-7, Bright INKS
  to indices 8-15, PAPERs to indices 16-23 and Bright PAPERs to
  indices 24-31.  In ULANext mode, INKs come from a subset of indices
  0-127 and PAPERs come from a subset of indices 128-255.  The number
  of active indices depends on the number of attribute bits assigned
  to INK and PAPER out of the attribute byte.  In ULA+ mode, the top
  64 entries hold the ula+ palette.  The ULA always takes border
  colour from paper for standard ULA and ULAnext.
</td></tr></table>

<P>
(R/W) $41 (65) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Value (8 bit colour)
<table width="90%">
bits 7-0 = Colour for the palette index selected by nextreg
  $40.<tr><td valign="top">&nbsp;The format is RRRGGGBB - the lower blue bit of the 9-bit
  colour will be the logical OR of blue bits 1 and 0 of this 8-bit
  value.</td></tr>
<tr><td valign="top">&nbsp;After the write, the palette index is auto-incremented to the
  next index if the auto-increment is enabled in nextreg $43.  Reads
  do not auto-increment.  Any other bits associated with the index
  will be zeroed.
</td></tr></table>

<P>
(R/W) $43 (67) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Control

<UL>
<LI>bit 7 = Disable palette write auto-increment (soft reset = 0)
</LI>
<LI>bits 6-4 = Select palette for reading or writing (soft reset =
  000)
  
<UL>
<LI>000 = ULA first palette
</LI>
<LI>100 = ULA second palette
</LI>
<LI>001 = Layer 2 first palette
</LI>
<LI>101 = Layer 2 second palette
</LI>
<LI>010 = Sprites first palette 
</LI>
<LI>110 = Sprites second palette
</LI>
<LI>011 = Tilemap first palette
</LI>
<LI>111 = Tilemap second palette
  
</LI>
</UL>
</LI>
<LI>bit 3 = Select Sprites palette (0 = first palette, 1 = second
  palette) (soft reset = 0)
</LI>
<LI>bit 2 = Select Layer 2 palette (0 = first palette, 1 = second
  palette) (soft reset = 0)
</LI>
<LI>bit 1 = Select ULA palette (0 = first palette, 1 = second
  palette) (soft reset = 0)
</LI>
<LI>bit 0 = Enable ULANext mode (soft reset = 0)
</LI>
</UL>

<P>
(R/W) $44 (68) <SPAN CLASS="MATH"><IMG STYLE="height: 1.06ex; vertical-align: -0.11ex; " SRC="img2.svg"
 ALT="$\Rightarrow$"></SPAN> Palette Value (9 bit colour)
<table width="90%"><tr><td valign="top">&nbsp;Two consecutive writes are needed to write the 9 bit colour</td></tr>
<tr><td valign="top">&nbsp;1st write:
bits 7-0 = RRRGGGBB</td></tr>
<tr><td valign="top">&nbsp;2nd write:
bits 7-1 = Reserved, must be 0
bit 0 = lsb B</td></tr>
<tr><td valign="top">&nbsp;If writing to an L2 palette
bit 7 = 1 for L2 priority colour, 0 for normal.</td></tr>
<tr><td valign="top">&nbsp;An L2 priority colour moves L2 above all layers.  If you need
  the same colour in both priority and normal modes, you will need to
  have two different entries with the same colour one with and one
  without priority.  If auto-increment is enabled in nextreg $43, the
  palette index is auto-incremented after two consecutive writes</td></tr>
<tr><td valign="top">&nbsp;Reads only return the 2nd byte and do not auto-increment.</td></tr>
<tr><td valign="top">&nbsp;can also be read back from nextreg $28
</td></tr></table>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node8.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node6.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node6.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html323"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html325"
  HREF="node156.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node8.html">Scrolling</A>
<B> Up:</B> <A
 HREF="node6.html">Palette</A>
<B> Previous:</B> <A
 HREF="node6.html">Palette</A>
 &nbsp; <B>  <A ID="tex2html324"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html326"
  HREF="node156.html">Index</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
